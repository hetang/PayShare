var payShare=function(e){function f(){n.maskDiv.addClass("show").addClass("fadeIn").removeClass("hidden");n.fullPageSpinner.removeClass("hidden")}function l(){n.maskDiv.removeClass("show").removeClass("fadeIn").addClass("hidden");n.fullPageSpinner.addClass("hidden")}function c(t){if(!n.home.hasClass("hidden")){n.home.addClass("hidden");n.home.addClass("visuallyhidden")}else if(!n.trxHstry.hasClass("hidden")){n.trxHstry.addClass("hidden");n.trxHstry.addClass("visuallyhidden");e(window).off("scroll")}n.sendMoney.removeClass("hidden");n.sndMnyBdy.removeClass("hidden");n.transferBtnsDiv.removeClass("hidden");n.homeBtns.addClass("hidden");n.msgDiv.addClass("hidden");setTimeout(function(){n.sendMoney.removeClass("visuallyhidden")},20);if(!t){w();var r={url:window.location.href,userData:{type:"sendMoney"}};y(r,false)}}function h(){if(!n.trxHstry.hasClass("hidden")){n.trxHstry.addClass("hidden");n.trxHstry.addClass("visuallyhidden");e(window).off("scroll")}else if(!n.sendMoney.hasClass("hidden")){n.sendMoney.addClass("hidden");n.sendMoney.addClass("visuallyhidden")}n.sendMoney.addClass("hidden");n.sendMoney.addClass("visuallyhidden");n.home.removeClass("hidden");setTimeout(function(){n.home.removeClass("visuallyhidden")},20)}function p(t){if(!n.home.hasClass("hidden")){n.home.addClass("hidden");n.home.addClass("visuallyhidden")}else if(!n.sendMoney.hasClass("hidden")){n.sendMoney.addClass("hidden");n.sendMoney.addClass("visuallyhidden")}n.trxHstry.removeClass("hidden");setTimeout(function(){n.trxHstry.removeClass("visuallyhidden")},20);if(!t){d(false);var r={url:window.location.href,userData:{type:"transactionHistory"}};y(r,false)}e(window).on("scroll",function(){if(e(window).scrollTop()>=e(document).height()-e(window).height()-65&&e(window).scrollTop()!=0&&n.trxnTable.children().length>0){if(!a){a=true;d(true)}}}).scroll()}function d(t){if(t){n.loadmore.removeClass("hidden")}else{f()}if(typeof r==="undefined"){var u=e("#payHistory").html();r=Handlebars.compile(u)}if(typeof o!=="undefined"){o.abort()}o=e.ajax({type:"GET",url:"/hst",data:{sindex:i,ipg:s}}).done(function(e){if(typeof e!=="undefined"){var t=r(e);n.trxnTable.append(t);i+=s+1}}).fail(function(){}).always(function(){a=false;if(t){n.loadmore.addClass("hidden")}else{l()}})}function v(e){if(typeof e!=="undefined"){e.focus();e.addClass("error");setTimeout(function(){e.removeClass("error")},5e3)}}function m(e,t){n.msgText.html(e);n.mark.addClass(t);n.sndMnyBdy.addClass("hidden");n.msgDiv.removeClass("hidden");n.transferBtnsDiv.addClass("hidden");n.homeBtns.removeClass("hidden")}function g(){n.transferForm.submit(function(t){var r=e(this).serializeArray(),i=e(this).attr("action"),s=n.form.email.val(),o=Number(n.form.amount.val()),a=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!a.test(s)){v(n.form.email);return false}else if(!(o>0)){v(n.form.amount);return false}f();if(typeof u!=="undefined"){u.abort()}u=e.ajax({url:i,type:"POST",data:r}).done(function(e){if(typeof e!=="undefined"){if(typeof e.success!=="undefined"&&e.success===true){var t=n.form.currency.val(),r=n.form.currency.find(":selected").data("symbol"),i="You have sent "+r+o+" "+t+" to "+s;m(i,"sucessMark");return true}}var i="Something went wrong. Please try again.";m(i,"failureMark")}).fail(function(){var e="Looks like network issue. Please check your network.";m(e,"failureMark")}).always(function(){l();u=undefined});t.preventDefault()})}function y(e,t){if(!history.pushState)return false;var n=null;if(typeof e!=="undefined"&&typeof e.url!=="undefined"&&typeof e.url==="string"){n=e.url}if(n==null){n=window.location.href}if(t){history.replaceState(e,"",n)}else{history.pushState(e,"",n)}}function b(e){var t=e.originalEvent.state;if(typeof t!=="undefined"){if(typeof t.userData!=="undefined"){switch(t.userData.type){case"sendMoney":c(true);break;case"transactionHistory":p(true);break;default:h(true);break}}}}function w(){n.form.email.val("");n.form.amount.val("");n.form.msg.val("");n.form.currency.find('option[value="USD"]').prop("selected",true);n.symbol.html(n.currencyDropDown.find(":selected").data("symbol"));var t=e(".check");if(t.length>0){e.each(t,function(t,n){if(t==0){e(n).addClass("selected")}else{e(n).removeClass("selected")}})}}function E(){e(window).resize(function(){n.mainContainer.css({height:e(window).height()-124+"px"})});n.optionDiv.on("click",".check",function(){n.optionDiv.find(".selected").removeClass("selected");e(this).addClass("selected");e("#srvTyp").val(e(this).data("value"))});n.currencyDropDown.change(function(){n.symbol.html(e(this).find(":selected").data("symbol"))});n.sendMoneyBtn.bind("click",function(){c(false)});n.sndMnyInlineBtn.bind("click",function(){w();c(true)});n.clearBtn.bind("click",function(e){w()});n.viewTrxBtn.bind("click",function(){p(false)});n.vwTrxInlineBtn.bind("click",function(){p(false)});n.nextBtn.bind("click",function(){n.transferForm.submit()});e(window).bind("popstate",e.proxy(b,this))}var t={},n={mainContainer:e("#mainContainer .body"),optionDiv:e("#option"),currencyDropDown:e("#currency"),symbol:e("#symbol"),home:e("#home"),sendMoney:e("#sndMnyDiv"),trxHstry:e("#trxHstryDiv"),sendMoneyBtn:e("#sndMny"),sndMnyInlineBtn:e("#sndMnyInline"),sndMnyBdy:e("#sndMnyBdy"),msgDiv:e("#msgDiv"),viewTrxBtn:e("#vwTrx"),vwTrxInlineBtn:e("#vwTrxInline"),clearBtn:e("#clearForm"),nextBtn:e("#nextStep"),loadmore:e("#loadmore"),maskDiv:e("#maskId"),fullPageSpinner:e("#spinnerMsk"),transferForm:e("#mnyTrsfr"),mark:e("#mark"),msgText:e("#msgText"),transferBtnsDiv:e("#transferBtns"),homeBtns:e("#homeBtns"),trxnTable:e("#TrxnTable"),form:{email:e("#sndrMail"),amount:e("#amount"),msg:e("#msg"),currency:e("#currency")}},r=undefined,i=0,s=20,o=undefined,u=undefined,a=false;t.init=function(){n.mainContainer.css({height:e(window).height()-124+"px"});n.symbol.html(n.currencyDropDown.find(":selected").data("symbol"));E();g();var t={url:window.location.href,userData:{type:"home"}};y(t,true)};return t}(jQuery);$(document).ready(function(){payShare.init()})